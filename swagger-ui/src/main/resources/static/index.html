<!DOCTYPE html>
<header>
  <meta charset="UTF-8">
  <title>API文档主页</title>
  <script src="libs/qs.min.js"></script>
  <script src="libs/axios/axios.js"></script>
  <script src="libs/vue/vue.js"></script>
  <script src="js/common/common.js"></script>
  <script src="js/api/DocumentController.js"></script>
  
  <link rel="stylesheet" type="text/css" href="libs/swagger/swagger-ui.css" >
  <link rel="icon" type="image/png" href="libs/swagger/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="libs/swagger/favicon-16x16.png" sizes="16x16" />
  <script src="libs/swagger/swagger-ui-bundle.js"> </script>
  <script src="libs/swagger/swagger-ui-standalone-preset.js"> </script>
  <!-- 引入样式 -->
  <link
    rel="stylesheet"
    href="libs/element-ui/lib/theme-chalk/index.css"
  />
  <!-- 引入组件库 -->
  <script src="libs/element-ui/lib/index.js"></script>
  <script src="libs/zui/lib/jquery/jquery.js"></script>
</header>
<body id="win" class="no-scroller">
  <div id="app">
        <el-row :gutter="20">
                <el-col :span="4">
                  <div id="left-menu" class="grid-content bg-purple">
                        <el-menu class="el-menu-vertical-demo" v-on:close="onMenuSelect" v-on:open="onMenuSelect">
                                <el-submenu :index="doc.filename" v-for="(doc,index) in data">
                                  <template slot="title">
                                    <i class="el-icon-notebook-1"></i>
                                    <span slot="title">{{doc.openAPI.info.title}}</span>
                                  </template> 
                                  <el-submenu v-bind:index="tag.query" v-for="tag in doc.tags">
                                    <template slot="title">
                                      <i class="el-icon-document"></i>
                                      <span slot="title">{{tag.name}}</span>
                                    </template> 
                                  </el-submenu>
                                </el-submenu>
                                <el-submenu index="menu-setting">
                                    <template slot="title">
                                      <i class="el-icon-setting"></i>
                                      <span slot="title">文档配置</span>
                                    </template> 
                                </el-submenu>
                        </el-menu>
                    </div>
                </el-col>
                <el-col :span="20">
                  <div class="grid-content bg-purple">
                    <iframe id="swagger" width="100%" height="100%"></iframe>
                  </div>
              </el-col>
        </el-row>
    </div>
  
  <style>
    .el-menu-vertical-demo:not(.el-menu--collapse) {
      width: 100%;
      height: 100%;
      overflow: auto;
    }
    .el-row{
      margin-left: 0px!important;
      margin-right: 0px!important;
    }
    .el-col{
      padding-left: 0px!important;
      padding-right: 0px!important;
    }
 
 
  </style>


  <script>
    var dc = new DocumentController();
    dc.getAllDocument(function(resp) {
      if (resp.data.success) {
        initView(resp.data.data);
      }
    });
    function initView(data) {
        if(data.length>0){
            updateSwaggerUI(data[0].filename)
        }
        
        var appData = {
            data: function() {
                return {
                    visible: false,
                    data:data,
                    uploadUrl:host+"/doc/api"+"/document"+"/upload"
               };
           },
           methods:{
               onMenuSelect:function(doc){
                 if('menu-setting'==doc){
                   document.getElementById("swagger").src="setting.html";
                 }else{
                   console.log(doc);
                   updateSwaggerUI(doc);
                 }
                   
               },
               onUploadSuccess:function(resp){
                 if(resp.success){
                   alert("上传文档成功");
                 }else{
                  alert("上传文档失败："+resp.description);
                 }
               }
           }
        };
        var Ctor = Vue.extend(appData);
        new Ctor().$mount("#app");

    }
    function updateSwaggerUI(filename){
    	filename=encodeURIComponent(filename);
     document.getElementById("swagger").src="swagger.html?url="+host+"/doc/api/document/info/"+filename;
      //window.ui = ui
    }
  </script>

<script>
  // 定义事件侦听器函数
  function displayWindowSize() {
    // 获取窗口的宽度和高度，不包括滚动条
    var w = document.documentElement.clientWidth-15;
    var h = document.documentElement.clientHeight-20;
    // 在div元素中显示结果
    console.log("宽: " + w + ", " + "高: " + h);
    $("#win").css("height",h+"px");
    $("#win").css("width",w+"px");
    $("#swagger").css("height",h+"px");
    $("#left-menu").css("height",h+"px");
    
  }
  // 将事件侦听器函数附加到窗口的resize事件
  window.addEventListener("resize", displayWindowSize);
  // 第一次调用该函数
  displayWindowSize();
  </script>
</body>
